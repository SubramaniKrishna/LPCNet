WARNING:tensorflow:From /home/ubuntu/git/LPCNet/./training_tf2/train_lpcnet.py:104: _CollectiveAllReduceStrategyExperimental.__init__ (from tensorflow.python.distribute.collective_all_reduce_strategy) is deprecated and will be removed in a future version.
Instructions for updating:
use distribute.MultiWorkerMirroredStrategy instead
Model: "model"
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to
==================================================================================================
input_3 (InputLayer)            [(None, None, 1)]    0
__________________________________________________________________________________________________
embed_pitch (Embedding)         (None, None, 1, 64)  16384       input_3[0][0]
__________________________________________________________________________________________________
input_2 (InputLayer)            [(None, None, 38)]   0
__________________________________________________________________________________________________
reshape_2 (Reshape)             (None, None, 64)     0           embed_pitch[0][0]
__________________________________________________________________________________________________
concatenate_2 (Concatenate)     (None, None, 102)    0           input_2[0][0]
                                                                 reshape_2[0][0]
__________________________________________________________________________________________________
input_1 (InputLayer)            [(None, None, 3)]    0
__________________________________________________________________________________________________
feature_conv1 (Conv1D)          (None, None, 128)    39296       concatenate_2[0][0]
__________________________________________________________________________________________________
lambda (Lambda)                 (None, None, 1)      0           input_1[0][0]
                                                                 input_1[0][0]
                                                                 input_1[0][0]
__________________________________________________________________________________________________
feature_conv2 (Conv1D)          (None, None, 128)    49280       feature_conv1[0][0]
__________________________________________________________________________________________________
concatenate (Concatenate)       (None, None, 3)      0           lambda[0][0]
                                                                 lambda[1][0]
                                                                 lambda[2][0]
__________________________________________________________________________________________________
feature_dense1 (Dense)          (None, None, 128)    16512       feature_conv2[0][0]
__________________________________________________________________________________________________
embed_sig (Embedding)           (None, None, 3, 128) 32768       concatenate[0][0]
__________________________________________________________________________________________________
feature_dense2 (Dense)          (None, None, 128)    16512       feature_dense1[0][0]
__________________________________________________________________________________________________
reshape (Reshape)               (None, None, 384)    0           embed_sig[0][0]
__________________________________________________________________________________________________
lambda_2 (Lambda)               (None, None, 128)    0           feature_dense2[0][0]
                                                                 feature_dense2[0][0]
__________________________________________________________________________________________________
concatenate_3 (Concatenate)     (None, None, 512)    0           reshape[0][0]
                                                                 lambda_2[0][0]
__________________________________________________________________________________________________
gru_a (CuDNNGRU)                [(None, None, 384),  1034496     concatenate_3[0][0]
__________________________________________________________________________________________________
concatenate_4 (Concatenate)     (None, None, 512)    0           gru_a[0][0]
                                                                 lambda_2[1][0]
__________________________________________________________________________________________________
gru_b (CuDNNGRU)                [(None, None, 16), ( 25440       concatenate_4[0][0]
__________________________________________________________________________________________________
input_7 (InputLayer)            [(None, None, 16)]   0
__________________________________________________________________________________________________
dual_fc (MDense)                (None, None, 256)    9216        gru_b[0][0]
==================================================================================================
Total params: 1,239,904
Trainable params: 1,239,904
Non-trainable params: 0
__________________________________________________________________________________________________
ulaw std =  27.87997231174097
Epoch 1/120
   1/2604 [..............................] - ETA: 37:58:11 - loss: 5.5219 - sparse_categorical_accuracy: 0.1697
Traceback (most recent call last):
  File "/home/ubuntu/git/LPCNet/./training_tf2/train_lpcnet.py", line 178, in <module>
    model.fit([in_data, features,lpcoeffs, periods], out_exc, batch_size=batch_size, epochs=nb_epochs, validation_split=0.0, callbacks=[checkpoint, sparsify, WandbCallback()])
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/wandb/integration/keras/keras.py", line 124, in new_v2
    return old_v2(*args, **kwargs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/engine/training.py", line 1105, in fit
    callbacks.on_train_batch_end(end_step, logs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/callbacks.py", line 454, in on_train_batch_end
    self._call_batch_hook(ModeKeys.TRAIN, 'end', batch, logs=logs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/callbacks.py", line 296, in _call_batch_hook
    self._call_batch_end_hook(mode, batch, logs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/callbacks.py", line 316, in _call_batch_end_hook
    self._call_batch_hook_helper(hook_name, batch, logs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/callbacks.py", line 360, in _call_batch_hook_helper
    hook(batch, numpy_logs)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/wandb/integration/keras/keras.py", line 533, in on_train_batch_end
    wandb.run.summary["graph"] = wandb.Graph.from_keras(self.model)
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/wandb/data_types.py", line 1365, in from_keras
    for in_layer in _nest(in_node.inbound_layers):
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/engine/node.py", line 261, in inbound_layers
    inbound_layers = nest.map_structure(lambda t: t._keras_history.layer,
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 659, in map_structure
    structure[0], [func(*x) for x in entries],
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/util/nest.py", line 659, in <listcomp>
    structure[0], [func(*x) for x in entries],
  File "/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.9/site-packages/tensorflow/python/keras/engine/node.py", line 261, in <lambda>
    inbound_layers = nest.map_structure(lambda t: t._keras_history.layer,
AttributeError: 'tensorflow.python.framework.ops.EagerTensor' object has no attribute '_keras_history'